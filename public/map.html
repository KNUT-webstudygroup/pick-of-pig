<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>Pick Of Pig</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=81txquof2j&submodules=geocoder"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
</head>
<body>
    <div id="map" style="width:100%;height:800px;"></div>
    <div class="search">
        <input type="text" id="address" />
        <input id="submit" type="button" value="검색" />
    </div>
    <table>
        <thead>
            <tr>
                <th>주소</th><th>위도</th><th>경도</th>
            </tr>
        </thead>
        <tbody id="mapList">
        </tbody>
    </table>
</body>
<script>

    drawMap();
    function drawMap() {
        new naver.maps.Map("map", {
            center: new naver.maps.LatLng(37.3595316, 127.1052133), // 주소 기본 위치
            zoom: 15,
            mapTypeControl: true
        });
    }
    function searchAddress(address) {
        searchAddressToCoordinate(address);
    }
    // 주소를 좌표로 변환하여 검색
    function searchAddressToCoordinate(address) {
        const locations = [];
        naver.maps.Service.geocode({
            query: address
        }, function(status, response) {
            if (status === naver.maps.Service.Status.ERROR) {
                return alert('Something Wrong!');
            }

            if (response.v2.meta.totalCount === 0) {
                return alert('검색된 주소의 개수: ' + response.v2.meta.totalCount);
            }

            const items = response.v2.addresses;

            items.map((item) => {
                let location = {
                    latitude: item.x,
                    longitude: item.y,
                };
                locations.push(location);
            })
            addMarkers(locations);
        });
        return locations;
    }

    // 다중 마커 추가, 마커들의 중심 위치로 지도 이동
    function addMarkers(locations) {
        var map = new naver.maps.Map("map", {
            center: new naver.maps.LatLng(37.3595316, 127.1052133),
            zoom: 12,
            mapTypeControl: true
        });
        for (let location of locations) {
            addMarker(location.latitude, location.longitude);
        }
    }

    // 해당 좌표에 마커 추가
    function addMarker(latitude, longitude) {
        var map = new naver.maps.Map("map", {
            center: new naver.maps.LatLng(longitude, latitude),
            zoom: 12,
            mapTypeControl: true
        });
        var marker = new naver.maps.Marker({
            map: map,
            position: new naver.maps.LatLng(longitude, latitude),
        });

        console.log(address);
        let addr = $("#address").val();
        let mapList = "";
	        mapList += "<tr>";
	        mapList += "<td>" + addr + "</td>";
	        mapList += "<td>" + latitude + "</td>";
	        mapList += "<td>" + longitude + "</td>";
	        mapList += "</tr>";

	    $('#mapList').append(mapList);
    }
    $('#submit').on('click', function(e) {
        e.preventDefault();
        searchAddress($('#address').val());
    });
</script>
</html>